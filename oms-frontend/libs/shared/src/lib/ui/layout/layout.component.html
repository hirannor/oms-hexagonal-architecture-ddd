<div class="layout-container">
  <header class="layout-header p-shadow-3">
    <div class="header-left">
      <h2>
        <a class="app-title-link" routerLink="/products">
          OMS - Order Management System
        </a>
      </h2>
    </div>

    <lib-oms-search-bar></lib-oms-search-bar>

    <div class="header-right">
      <button
        pButton
        type="button"
        pTooltip="Notifications"
        rounded="true"
        pBadge
        tooltipPosition="bottom"
        [value]="(notifications$ | async)?.length || ''"
        (click)="toggleOverlay()"
        [ngClass]="{
          'notification-button': true,
          'has-notifications': hasNotifications$ | async
        }"
      >
        <span class="pi pi-bell" pButtonIcon></span>
      </button>

      <p-overlay
        [(visible)]="overlayVisible"
        appendTo="body"
        class="notification-overlay"
        (onHide)="overlayVisible = false"
      >
        <div class="notification-panel">
          @if (notifications$ | async; as notifications) { @if
          (notifications.length > 0) {
          <ul class="notifications-list">
            @for (n of notifications; track n.timestamp) {
            <li [ngClass]="n.type">
              <div class="title">{{ n.title }}</div>
              <div class="message">{{ n.message }}</div>
              <small>{{ n.timestamp | date : 'shortTime' }}</small>
            </li>
            }
          </ul>

          <button
            pButton
            pButtonLabel="Clear All"
            class="p-button-text p-button-sm"
            (click)="onClearAll()"
          >
            Clear All
          </button>
          } @else {
          <p class="empty">No notifications</p>
          } }
        </div>
      </p-overlay>

      <button
        pButton
        pTooltip="My Basket"
        rounded="true"
        routerLink="/basket"
        tooltipPosition="bottom"
        type="button"
      >
        <span class="pi pi-shopping-cart" pButtonIcon></span>
      </button>

      <button
        pButton
        pTooltip="My Orders"
        rounded="true"
        routerLink="/orders"
        tooltipPosition="bottom"
        type="button"
      >
        <span class="pi pi-list" pButtonIcon></span>
      </button>

      <p-menu
        #profileMenu
        [model]="profileItems"
        [popup]="true"
        appendTo="body"
      >
      </p-menu>
      <p-avatar
        (click)="profileMenu.toggle($event)"
        class="cursor-pointer"
        shape="circle"
      >
        <span class="pi pi-user" pButtonIcon></span>
      </p-avatar>
    </div>
  </header>

  <div class="layout-body">
    <aside class="layout-sidebar p-shadow-2">
      <p-panelMenu [model]="sidebarItems"></p-panelMenu>
    </aside>

    <main class="layout-content">
      <div class="page-content">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>

  <footer class="layout-footer p-shadow-2">
    <p>© 2025 OMS - All rights reserved</p>
  </footer>
</div>
